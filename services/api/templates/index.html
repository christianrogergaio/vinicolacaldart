<!DOCTYPE html>
<html class="light" lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dashboard - Vinícola Caldart</title>
    <script src="/static/vendor/js/tailwindcss.js"></script>
    <link href="/static/vendor/css/material-symbols.css" rel="stylesheet" />
    <link href="/static/vendor/css/inter.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/vendor/css/fontawesome.min.css">

    <!-- Scripts do Sistema -->
    <script src="/static/vendor/js/chart.js"></script>
    <script src="/static/vendor/js/chartjs-adapter-date-fns.bundle.min.js"></script>

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "forest-base": "#333333",
                        "forest-deep": "#1f1f1f",
                        "forest-light": "#8DC6A5",
                        "sage": "#74C69D", // Standardized
                        "sage-light": "#B7E4C7", // Standardized
                        "sage-dark": "#1f563b",
                        "off-white": "#F0F7F4",
                        "coral": "#E53E3E",
                        "amber": "#ED8936",
                        "gray-border": "#E6FFFA",
                        "slate-blue": "#64748B", // Standardized
                        "bg-main": "#F8FAFC", // Standardized
                        "text-primary": "#1E293B", // Standardized
                        "text-secondary": "#64748B", // Standardized
                        "border-light": "#E2E8F0" // Standardized
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"],
                        "display": ["Inter", "sans-serif"]
                    },
                    boxShadow: {
                        'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px -1px rgba(0, 0, 0, 0.02)',
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03)'
                    }
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24;
        }

        .glass-sidebar {
            background-color: #FFFFFF;
            border-right: 1px solid #E2E8F0;
        }

        body {
            background-color: #F8FAFC;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }

        /* Modal Default Hidden */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body
    class="bg-bg-main text-text-primary font-display overflow-hidden selection:bg-sage-light selection:text-text-primary">

    <div class="flex h-screen w-full relative">
        <!-- SIDEBAR (Standardized) -->
        <aside
            class="w-20 lg:w-72 flex-shrink-0 flex flex-col justify-between glass-sidebar hidden md:flex transition-all duration-300 z-30 shadow-sm">
            <div class="flex flex-col gap-4 p-4">
                <div class="flex items-center gap-3 mb-6 px-2">
                    <div class="bg-center bg-no-repeat bg-cover rounded-full size-10 border border-border-light shadow-sm"
                        style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAT85F7FK09URnVe_O7jeFwiT7P4IAtY-gPqUMa5vgwX70MUhH1XMoy1NZO8AtKJ8xKMLHYCJiJBqgju0KSF2_VdYjmMCn71_-xZ5IpTJh3ydB4ZIx3vGXUoKG8GWH6G_GDVoV3ck88-sLQLiltGZDJJuRK0MW7EAjMxuTomV038Ct9W34umP81kYu8xgUgeZeeXTU8TnMc3vfzFc-KkD1ArNJ1GHt5NeojF0ITsPpKw7xoPMWcYutu55KkEYVsE8ziCBqRp_zvhWI");'>
                    </div>
                    <div class="hidden lg:flex flex-col">
                        <h1 class="text-text-primary text-base font-bold leading-normal tracking-wide">Vinícola Caldart
                        </h1>
                        <p class="text-text-secondary text-xs font-normal">v2.4.0 • Monitoramento</p>
                    </div>
                </div>
                <nav class="flex flex-col gap-1">
                    <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-slate-50 border border-border-light shadow-sm"
                        href="/">
                        <span class="material-symbols-outlined text-sage">dashboard</span>
                        <p class="text-text-primary text-sm font-medium hidden lg:block">Dashboard</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 transition-colors group"
                        href="/analise">
                        <span
                            class="material-symbols-outlined text-text-secondary group-hover:text-text-primary">analytics</span>
                        <p
                            class="text-text-secondary group-hover:text-text-primary text-sm font-medium hidden lg:block">
                            Relatórios</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 transition-colors group"
                        href="/relatorios">
                        <span
                            class="material-symbols-outlined text-text-secondary group-hover:text-text-primary">history</span>
                        <p
                            class="text-text-secondary group-hover:text-text-primary text-sm font-medium hidden lg:block">
                            Histórico</p>
                    </a>
                </nav>
            </div>
            <div class="p-4 border-t border-border-light">
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 transition-colors group"
                    href="#">
                    <span
                        class="material-symbols-outlined text-text-secondary group-hover:text-text-primary">help</span>
                    <p class="text-text-secondary group-hover:text-text-primary text-sm font-medium hidden lg:block">
                        Ajuda</p>
                </a>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col h-full overflow-y-auto relative z-10 scroll-smooth bg-bg-main">
            <!-- HEADER (Standardized) -->
            <header class="sticky top-0 z-20 bg-bg-main/90 backdrop-blur-md border-b border-border-light px-6 py-5">
                <div class="flex flex-wrap items-end justify-between gap-4 max-w-[1400px] mx-auto w-full">
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-sage text-[20px]">calendar_today</span>
                            <!-- Using standard header date ID -->
                            <span class="text-sage text-sm font-medium" id="header-date">--</span>
                        </div>
                        <h1 class="text-text-primary text-2xl lg:text-3xl font-black leading-tight tracking-tight">
                            Monitoramento
                            dos Vinhedos</h1>
                        <p class="text-text-secondary text-sm font-normal" id="last-update">Atualizando...</p>
                    </div>

                    <!-- Top Filters (Context) moved here for layout consistency -->
                    <div class="flex flex-wrap items-center gap-3">
                        <div class="hidden md:flex gap-2 items-center mr-4">
                            <select id="sel-planta"
                                class="bg-white border border-border-light rounded-lg text-xs font-medium text-text-primary focus:ring-sage py-1.5 px-3"></select>
                            <select id="sel-doenca"
                                class="bg-white border border-border-light rounded-lg text-xs font-medium text-text-primary focus:ring-sage py-1.5 px-3"></select>
                            <select id="sel-estadio"
                                class="bg-white border border-border-light rounded-lg text-xs font-medium text-text-primary focus:ring-sage py-1.5 px-3"></select>
                            <button id="btn-atualizar"
                                class="text-sage hover:text-sage-dark p-1.5 rounded hover:bg-sage/10 transition-all">
                                <i class="fa-solid fa-rotate-right"></i>
                            </button>
                        </div>

                        <div
                            class="flex h-9 items-center justify-center gap-x-2 rounded-full bg-white border border-border-light pl-3 pr-4 shadow-sm">
                            <span class="relative flex h-2.5 w-2.5">
                                <span
                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-sage opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-sage"></span>
                            </span>
                            <p class="text-text-primary text-xs font-bold uppercase tracking-wider">Ao Vivo</p>
                        </div>

                        <div class="pl-4 ml-2 border-l border-border-light flex items-center gap-3">
                            <button
                                class="relative flex size-9 items-center justify-center rounded-full hover:bg-gray-100 text-gray-500 transition-colors">
                                <span class="material-symbols-outlined text-[20px]">notifications</span>
                                <span
                                    class="absolute top-2 right-2 size-2 rounded-full bg-coral border border-white"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <div class="flex-1 px-6 py-8 max-w-[1400px] mx-auto w-full flex flex-col gap-8">
                <!-- Action Bar -->
                <div class="flex justify-end">
                    <button id="btn-registrar"
                        class="flex items-center justify-center rounded-xl h-10 px-5 bg-sage text-white text-sm font-semibold shadow-sm hover:bg-sage/90 transition-all transform hover:-translate-y-0.5">
                        <span class="material-symbols-outlined text-[20px] mr-2">add_task</span>
                        Nova Intervenção
                    </button>
                </div>

                <div class="flex flex-col xl:flex-row gap-6">
                    <!-- MAIN CHART CARD -->
                    <div class="flex-1 flex flex-col gap-6 min-h-[450px]">
                        <div
                            class="bg-white rounded-xl p-6 h-full min-h-[450px] w-full relative shadow-card border border-gray-200 border-t-4 border-t-sage flex flex-col">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-text-primary uppercase tracking-wider text-sm">Monitoramento
                                    em Tempo Real</h3>
                                <div class="flex gap-2 text-xs font-semibold">
                                    <span class="inline-flex items-center gap-1 text-amber"><span
                                            class="size-2 rounded-full bg-amber"></span> Temp</span>
                                    <span class="inline-flex items-center gap-1 text-sage"><span
                                            class="size-2 rounded-full bg-sage"></span> Umid</span>
                                </div>
                            </div>
                            <div class="flex-1 relative w-full h-full min-h-[350px]">
                                <canvas id="mainChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN KPIs -->
                    <div class="w-full xl:w-[400px] flex flex-col gap-6">
                        <!-- KPI GRID -->
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Card Temp -->
                            <div
                                class="bg-white p-5 rounded-xl flex flex-col gap-2 relative overflow-hidden shadow-card border border-gray-200 border-t-4 border-t-amber group hover:shadow-md transition-all">
                                <div
                                    class="absolute -right-6 -top-6 bg-amber/10 size-24 rounded-full group-hover:scale-110 transition-transform">
                                </div>
                                <div class="flex justify-between items-start z-10">
                                    <span
                                        class="text-text-secondary text-xs font-bold uppercase tracking-wider">Temperatura</span>
                                    <span class="material-symbols-outlined text-amber text-xl">thermostat</span>
                                </div>
                                <div class="mt-2 z-10">
                                    <p class="text-text-primary text-3xl font-bold"><span id="val-temp">--</span><span
                                            class="text-lg">°C</span></p>
                                    <span class="text-xs font-medium text-text-secondary">Sensor Campo 01</span>
                                </div>
                            </div>
                            <!-- Card Umid -->
                            <div
                                class="bg-white p-5 rounded-xl flex flex-col gap-2 relative overflow-hidden shadow-card border border-gray-200 border-t-4 border-t-sage group hover:shadow-md transition-all">
                                <div
                                    class="absolute -right-6 -top-6 bg-sage/10 size-24 rounded-full group-hover:scale-110 transition-transform">
                                </div>
                                <div class="flex justify-between items-start z-10">
                                    <span
                                        class="text-text-secondary text-xs font-bold uppercase tracking-wider">Umidade</span>
                                    <span class="material-symbols-outlined text-sage text-xl">water_drop</span>
                                </div>
                                <div class="mt-2 z-10">
                                    <p class="text-text-primary text-3xl font-bold"><span id="val-umid">--</span><span
                                            class="text-lg">%</span></p>
                                    <span class="text-xs font-medium text-text-secondary">Relativa do Ar</span>
                                </div>
                            </div>
                        </div>

                        <!-- CARD RISCO -->
                        <div id="card-risco"
                            class="bg-white rounded-xl p-6 relative overflow-hidden shadow-card border border-gray-200 border-t-4 border-t-gray-200 transition-colors">
                            <div
                                class="absolute top-0 right-0 w-32 h-32 bg-gray-100 rounded-full blur-[40px] pointer-events-none">
                            </div>
                            <div class="flex justify-between items-center mb-6 relative z-10">
                                <h3
                                    class="text-text-primary font-semibold flex items-center gap-2 text-sm uppercase tracking-wide">
                                    <span class="material-symbols-outlined text-text-primary">warning</span>
                                    Nível de Risco (VDS)
                                </h3>
                                <span
                                    class="text-[10px] font-bold text-white bg-slate-400 px-2 py-1 rounded-md">HOJE</span>
                            </div>
                            <div class="flex flex-col items-center justify-center py-4 relative z-10">
                                <p id="val-risco" class="text-4xl font-black text-center mb-1 text-slate-300">--</p>
                                <p class="text-sm font-medium text-text-secondary">Índice Atual</p>
                                <div class="mt-4 flex gap-4 text-xs font-semibold text-text-secondary">
                                    <span>VDS Dia: <span id="val-vds" class="text-text-primary">--</span></span>
                                </div>
                            </div>
                        </div>

                        <!-- CARD PREVISAO -->
                        <div id="card-previsao"
                            class="bg-white rounded-xl p-6 relative overflow-hidden shadow-card border border-gray-200 border-t-4 border-t-gray-200 transition-colors">
                            <div class="flex justify-between items-center relative z-10">
                                <h3
                                    class="text-text-primary font-semibold flex items-center gap-2 text-sm uppercase tracking-wide">
                                    <span class="material-symbols-outlined">network_intelligence</span>
                                    Previsão do Modelo
                                </h3>
                            </div>
                            <div class="flex flex-col items-center justify-center py-4 relative z-10">
                                <p class="text-sm text-text-secondary mb-1">Tendência para amanhã</p>
                                <p id="val-risco-futuro" class="text-2xl font-bold text-center text-text-primary">--</p>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- CICLO SOJA (Hidden by default) -->
                <div id="card-ciclo" class="bg-white rounded-xl p-6 shadow-card border border-gray-200"
                    style="display:none;">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-text-primary text-sm font-bold uppercase">Ciclo da Cultura (GDD)</h3>
                        <button id="btn-config-ciclo"
                            class="text-xs bg-slate-100 hover:bg-slate-200 px-3 py-1 rounded-lg font-semibold text-slate-600">
                            <i class="fa-solid fa-gear"></i> Configurar
                        </button>
                    </div>
                    <div class="flex items-center gap-8">
                        <div class="relative size-24">
                            <svg class="size-full" viewBox="0 0 36 36">
                                <path class="text-slate-100"
                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    fill="none" stroke="currentColor" stroke-width="4" />
                                <path id="progress-circle" class="text-sage transition-all duration-1000"
                                    stroke-dasharray="0, 100"
                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    fill="none" stroke="currentColor" stroke-width="4" />
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center flex-col">
                                <span id="txt-progresso" class="text-sm font-bold text-text-primary">0%</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 flex-1">
                            <div class="flex justify-between text-sm border-b border-gray-100 pb-2">
                                <span class="text-text-secondary">Acumulado</span>
                                <span class="font-bold text-text-primary" id="val-gdd-acumulado">--</span>
                            </div>
                            <div class="flex justify-between text-sm border-b border-gray-100 pb-2">
                                <span class="text-text-secondary">Meta</span>
                                <span class="font-bold text-text-primary" id="val-gdd-meta">--</span>
                            </div>
                            <div class="flex justify-between text-sm pt-1">
                                <span class="text-text-secondary">Colheita Prevista</span>
                                <span class="font-bold text-sage" id="txt-previsao-data">--/--</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MODAL REGISTRO (Adaptado ao novo estilo) -->
    <div id="modal-registro" class="modal-overlay">
        <div class="bg-white rounded-2xl w-[90%] max-w-md p-6 shadow-2xl scale-100 transition-transform">
            <div class="flex justify-between items-center mb-6 border-b border-gray-100 pb-4">
                <h3 class="text-lg font-bold text-text-primary flex items-center gap-2">
                    <span class="material-symbols-outlined text-sage">add_task</span>
                    Registrar Intervenção
                </h3>
                <button id="btn-fechar-modal" class="text-gray-400 hover:text-coral transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tipo</label>
                    <select id="reg-tipo"
                        class="w-full bg-slate-50 border-gray-200 rounded-lg text-sm text-text-primary focus:border-sage focus:ring-sage">
                        <option value="FUNGICIDA">Fungicida</option>
                        <option value="INSETICIDA">Inseticida</option>
                        <option value="ADUBO">Adubo Foliar</option>
                        <option value="IRRIGACAO">Irrigação</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Produto / Detalhes</label>
                    <input type="text" id="reg-produto" placeholder="Ex: Cobre, Enxofre..."
                        class="w-full bg-slate-50 border-gray-200 rounded-lg text-sm text-text-primary focus:border-sage focus:ring-sage">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Observações</label>
                    <textarea id="reg-obs" rows="3"
                        class="w-full bg-slate-50 border-gray-200 rounded-lg text-sm text-text-primary focus:border-sage focus:ring-sage"></textarea>
                </div>

                <button id="btn-salvar-registro"
                    class="w-full bg-sage hover:bg-sage-dark text-white font-bold py-3 rounded-xl shadow-lg shadow-sage/20 transition-all mt-4">
                    Salvar Registro
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL CICLO (Adaptado) -->
    <div id="modal-config-ciclo" class="modal-overlay">
        <div class="bg-white rounded-2xl w-[90%] max-w-sm p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-text-primary">Configurar Ciclo</h3>
                <button id="btn-fechar-config" class="text-gray-400 hover:text-coral"><i
                        class="fa-solid fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Data de Plantio</label>
                    <input type="date" id="cfg-data-plantio" class="w-full bg-slate-50 border-gray-200 rounded-lg">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Meta GDD</label>
                    <input type="number" id="cfg-meta-gdd" class="w-full bg-slate-50 border-gray-200 rounded-lg">
                </div>
                <button id="btn-salvar-config"
                    class="w-full bg-sage hover:bg-sage-dark text-white font-bold py-3 rounded-xl transition-all">
                    Salvar Configuração
                </button>
            </div>
        </div>
    </div>

    <!-- Load Main Logic -->
    <script src="/static/js/main.js?v=2.3"></script>
</body>

</html>